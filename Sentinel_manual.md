# Sentinel(分布式系统的流量防卫兵)手册
## 一、前言
```
网关及业务系统在没有任何保护措施的情况下,如果出现突发流量冲击,大到后台系统所能承受的极限,近而导致整体系统不可用,从而造成巨大损失.
就流控单从本质上而言,是以牺牲部分用户的可用性为代价,来换取先入用户的可用性.
```
## 二、限流
```
限流主要通过限制并发访问数(用户相关)或者一个时间窗口内请求数(非用户相关)来保护系统.
如果一旦达到限制数,对请求采取对应的拒绝策略,常见的有：转到错误页面、排队等待、降级(快速失败).
```
### 2.1 限流算法
1. `计数器算法`：限定时间周期内累加`访问次数`,当`访问次数`达到设定的阈值时触发限流策略,当进入下一个时间周期`访问次数`清零.这种算法存在一个`临界`问题.
2. `滑动窗口算法`：在固定时间窗口中分隔出多个`小时间窗口`,分别在分隔出的`小时间窗口`中记录`访问次数`,然后根据时间将`小时间窗口`往前滑动并删除过期的`小时间窗口`,最终统计所有`小点时间窗口`内的`访问次数`.
3. `令牌桶算法`：系统以一个恒定的速度往固定容量的令牌桶放入令牌,对于客户端每个请求都要先从令牌桶获取一个令牌(访问资格),如果未能获取则触发限流策略.
4. `漏桶算法`：控制数据注入网络的速度,平滑网络上的突发流量.系统在内部维护一个固定容量的容器,以恒定的速度出水,容器溢出则触发限流策略.
### 2.2 流控规则(FlowRule)

## 三、降级
```
服务熔断指的是当某个服务提供者不能正常为服务调用者提供服务时,为了防止因局部服务故障近而导致出现雪崩效应,而采取一系列保护措施.
```
### 降级规则(DegradeRule)
