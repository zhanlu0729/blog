### TOP 命令详解
1. top -p processID 查看进程的资源消耗情况
2. top -H -p processID 查看进程下所有线程的资源消耗情况

## top 统计信息前五行是系统整体的统计信息

### 1、第一行是任务队列信息 同uptime质性命令结果一样。
### 06:47:11 up  6:39,  3 users,  load average: 0.00, 0.01, 0.05
| 值 | 描述 |
| --------- | ------------ |
| 06:47:11 | 当前时间 | 
| up  6:39 | 系统运行时间，格式为时：分 | 
| 3 users  | 当前用户登录数 | 
| load average: 0.00, 0.01, 0.05| 系统负载，即任务队列的平均长度，三个数值分别为1分钟，5分钟，15分钟前到现在的平均值。一般来说，每个 CPU 内核当前活跃进程数不大于 3 ，则系统运行表现良好！也就是说主机是四核cpu的话，那么只要 uptime 最后输出的遗传数字数值小于 4*3=12 即表示系统负载不是很严重| 

### 2、第二行、三行为进程和 CPU 的信息。当有多个 CPU 时，内容可能超过两行。
### Tasks: 367 total,   2 running, 365 sleeping,   0 stopped,   0 zombie
### %Cpu(s):  0.0 us,  0.3 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
| 值 | 描述 |
| --------- | ------------ |
| Tasks: 367 total| 进程总数|
| 2 running | 正在运行的进程数|
| 365 sleeping| 睡眠的进程数|
| 0 stopped | 停止的进程数|
| 0 zombie  | 僵尸进程数|
| %Cpu(s):  0.0 us| 系统用户进程使用 CPU 百分比。不包括调高优先级的进程。 CPU%是由每个核的 CPU 占用率之和算出来的。如果你是 4 核 CPU，核 1，CPU 使用率为100%，核 2，CPU 使用率为100%，则会CPU 高于100%的现象，最终为200%|
| 0.3 sy |  内核中的进程占用 CPU 百分比|
| 0.0 ni |  用户进程空间内改变过优先级的进程占用 CPU 百分比|
| 99.7 id|  空闲 CPU 百分比|

### 4、第四行行为内存信息。
### KiB Mem :  1001332 total,   340616 free,   171456 used,   489260 buff/cache
### KiB Swap:  2097148 total,  2097036 free,      112 used.   630508 avail Mem
| 值 | 描述 |
| --------- | ------------ |
| Mem :  1001332 total| 物理内存总量|
| 171456 used| 使用的物理内存总量|
| 340616 free| 空闲物理内存|
| 489260 buff/cache| 用作内核缓存的内存量和free -k 一个意思|
| Swap:  2097148 total| 减缓区总量|
| 12 used| 使用交换空间呢总量|
| 2097036 free|  可用交换空间|
 
### 二、进程信息
### PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
### 138 root      20   0       0      0      0 R  0.3  0.0   0:00.83 rcuos/0
| 值 | 描述 |
| --------- | ------------ |
| PID| 进程id| 
| USER| 进程所有者的用户名| 
| NI| 进程优先级。nce值。负值表示高优先级，正值表示低优先者。| 
| RES| 实际使用内存大小| 
| S| 进程状态| 
| D  | 不可中断的睡眠状态| 
| R | 运行| 
| S | 睡眠| 
| T | 跟踪/停止| 
| Z | 僵尸进程| 
| | %CPU| 上次更新到现在的 CPU 时间占用百分比 | 
| %MEM|  进程使用的物理内存百分比| 
| TIME+| 进程使用CPU时间总计，单位  1/100s | 
| COMMAND|  命令名/命令行| 
top 快捷键：q  退出 M 按内存排序 P 按CPU 排序 <>  翻页


1、命令说明
top 参数
-h：help表示显示帮助的意思
-v：version显示版本的意思，和-h的功能一样
-u：user显示指定用户的进程，例如：top -u root
-p：pid显示指定进程，例如：top -p 1
-n：number进入top后，top会定时刷新状态，这个值就是设置刷新几次
-d：delay进入top后，top会定时刷新状态，这个值就是设置几秒刷新一次
-b：Batch mode，top刷新状态默认是在原数据上刷新，使用这个参数后，会一屏一屏的显示数据。结合重定向功能和计划任务，这个参数在记录服务器运行状态时非常有用。
以上一些参数是在输入命令时提供的参数，在top运行的过程中，还可以输入一些快捷键来调整显示内容。
一些命令运行时的快捷键说明：
q：quit退出程序
M：Memory按照内存使用量排序
P：CPU按照cpu使用量排序
k：kill杀死PID的进程，不输入PID，直接按回车就会退出
1：能显示CPU每个核心的情况
h或者?：help 查看更多快捷键
f：fields查看进程表头字段含义
2、命令测试
top
top命令测试
第一行说明：
top – ：系统当前时间
up：服务器连续运行的时间，笔者见过有服务器连续运行一年以上，linux服务器还是非常稳定的。
user：当前有多少用户登录系统
load average：这个边有3个数值分别表示系统在前1分钟，5分钟，15分钟的工作负载，根据笔者以往的经验来看单核负载在3-5之间比较合适，经常在1以下，说明cpu利用率不高，在5以上，cpu会处于较高负载状态，会容易宕机。有一次项目上线，晚上加班观察服务器状况，这个值长时间保持在72左右，因为服务器有八核，所以每核的值为9，后来服务器就挂了。
第二行就是显示任务的数量情况，其中zombie要注意一下，这个是表示僵尸进程，出现了僵尸进程要注意下僵尸进程是如何产生的。如果不找到产生原因，即使杀死了，可能也会再次出现。
第三行表示cpu的运行情况，按下1可以显示每个核的运行情况。
第四行表示内存memory的使用情况。
第五行表示交换空间swap的使用情况。
下面显示的就是进程的运行状态了。每个表头表示的含义如下：
PID：进程编号
USER：进程所属用户
PR/NI：Priority/Nice value进程执行的优先顺序
VIRT：Virtual Image (kb) 虚拟内存使用总额
RES：Resident size (kb) 常驻内存
SHR：Shared Mem size (kb) 共享内存
S：Process Status 进程状态
%CPU：cpu使用率
%MEM：内存使用率
TIME+：进程开始运行时使用cpu的总时间
COMMAND：进程运行的命令
在top状态下按f可以查看表头字段说明。
3、常用的命令：
top -b -n 60 -d 60 > /home/cpu.txt
该命令每隔60秒会将服务器运行状态保存到一个文本文件，共运行60次，其实就是将服务器1个小时的运行状态保存起来。使用这个命令，可以记录服务器在繁忙时的负载情况，例如设置到晚上8点到9点之间，这样就可以根据服务器状态作出调整，而不是等服务器挂了才来处理。上面命令各参数，大家可以根据自己需要修改。终于不用加班蹲点观察服务器了。
