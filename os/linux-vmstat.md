## vmstat 侦测系统资源变化
### vmstat [-a] [延迟 [总计侦测次数]] <==CPU/内存等信息
1. `-a`  #使用`inactive/active`(活跃与否) 取代`buffer/cache`的内存输出信息
2. `[延迟 [总计侦测次数]]` #[每隔多久 [共计多少次]]
3. `进程字段(procs)`的项目分别为：
- `r`：等待运作中的进程数量；
- `b`：不可被唤醒的进程数量。
- 这两个项目越多，代表系统越忙碌 (因为系统太忙，所以很多进程就无法被执行或一直在等待而无法被唤醒之故)。
4. `内存字段(memory)`项目分别为(这部份则与`free`是相同的)：
- `swpd`：虚拟内存被使用的容量；
- `free`：未被使用的内存容量；
- `buff`：用于缓冲存储器；
- `cache`：用于高速缓存。
5. `内存置换空间(swap)`的项目分别为：
- `si`：由磁盘中将进程取出的量；
- `so`：由于内存不足而将没用到的进程写入到磁盘的`swap`的容量。
- 如果`si/so`的数值太大，表示内存内的数据常常得在磁盘与主存储器之间传来传去，系统效能会很差
6. `磁盘读写(io)`的项目分别为：
- `bi`：由磁盘读入的区块数量； 
- `bo`：写入到磁盘去的区块数量。
- 如果这部份的值越高，代表系统的I/O非常忙碌
7. `系统(system)`的项目分别为：
- `in`：每秒被中断的进程次数； 
- `cs`：每秒钟进行的事件切换次数；
- 这两个数值越大，代表系统与接口设备的沟通非常频繁！这些接口设备当然包括磁盘、网络卡、时间钟等
8. `CPU`的项目分别为：
- `us`：非核心层的CPU使用状态；
- `sy`：核心层所使用的CPU状态；
- `id`：闲置的状态；
- `wa`：等待I/O所耗费的CPU状态；
- `st`：被虚拟机(virtual machine)所盗用的CPU使用状态(2.6.11 以后才支持)

### vmstat [-fs] <==内存相关
- `-f` ：开机到目前为止，系统复制 (fork) 的进程数
- `-s` ：将一些事件 (开机至目前为止) 导致的内存变化情况列表说明

### vmstat [-S 单位] <==设定显示数据的单位
- `-S` ：后面可以接单位，让显示的数据有单位。例如 K/M 取代 bytes 的容量

### vmstat [-d] <==与磁盘有关
- `-d` ：列出磁盘的读写总量统计表

### vmstat [-p 分区槽] <==与磁盘有关
1. `-p` ：后面列出分区槽，可显示该分区槽的读写总量统计表
2. 注:这些信息主要来自于`/proc/diskstats`
- `reads` ：来自于这个分区的读的次数.
- `read sectors` ：来自于这个分区的读扇区的次数.
- `writes` ：来自于这个分区的写的次数.
- `requested writes` ：来自于这个分区的写请求次数.

### 常见问题处理1
1. 如果`r`经常大于4且`id`经常少于40，表示cpu的负荷很重
2. 如果`pi`，`po`长期不等于0，表示内存不足
3. 如果disk经常不等于0，且在`b`中的队列大于3，表示io性能不好
4. 如果在processes中运行的序列(process r)是连续的大于在系统中的CPU的个数表示系统现在运行比较慢,有多数的进程等待CPU
5. 如果r的输出数大于系统中可用CPU个数的4倍的话,则系统面临着CPU短缺的问题,或者是CPU的速率过低,系统中有多数的进程在等待CPU,造成系统中进程运行过慢
6. 如果空闲时间(cpu id)持续为0并且系统时间(cpu sy)是用户时间的两倍(cpu us)系统则面临着CPU资源的短缺
7. 解决办法:当发生以上问题的时候请先调整应用程序对CPU的占用情况.使得应用程序能够更有效的使用CPU.同时可以考虑增加更多的CPU. 关于CPU的使用情况还可以结合mpstat,ps aux top prstat –a等等一些相应的命令来综合考虑关于具体的CPU的使用情况,和那些进程在占用大量的CPU时间.一般情况下，应用程序的问题会比较大一些.比如一些sql语句不合理等等都会造成这样的现象.

### 常见问题处理2
1. 内存的瓶颈是由scan rate (sr)来决定的.scan rate是通过每秒的始终算法来进行页扫描的.如果scan rate(sr)连续的大于每秒200页则表示可能存在内存缺陷.同样的如果page项中的pi和po这两栏表示每秒页面的调入的页数和每秒调出的页数.如果该值经常为非零值,也有可能存在内存的瓶颈,当然,如果个别的时候不为0的话,属于正常的页面调度这个是虚拟内存的主要原理.
2. 解决办法:a.调节applications & servers使得对内存和cache的使用更加有效.b.增加系统的内存.
